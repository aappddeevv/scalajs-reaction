<html><head><title>scalajs-react: Data Interop</title><meta charset="utf-8" /><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="aappddeevv" /><meta name="description" content="A react integration library for scala.js in the spirit of ReasonReact" /><meta name="og:image" content="/scalajs-react/img/poster.png" /><meta name="og:title" content="scalajs-react: Data Interop" /><meta name="og:site_name" content="scalajs-react" /><meta name="og:url" content="" /><meta name="og:type" content="website" /><meta name="og:description" content="A react integration library for scala.js in the spirit of ReasonReact" /><link rel="icon" type="image/png" href="/scalajs-react/img/favicon.png" /><meta name="twitter:title" content="scalajs-react: Data Interop" /><meta name="twitter:image" content="img/poster.png" /><meta name="twitter:description" content="A react integration library for scala.js in the spirit of ReasonReact" /><meta name="twitter:card" content="summary_large_image" /><link rel="icon" type="image/png" sizes="16x16" href="/scalajs-react/img/favicon16x16.png" /><link rel="icon" type="image/png" sizes="24x24" href="/scalajs-react/img/favicon24x24.png" /><link rel="icon" type="image/png" sizes="32x32" href="/scalajs-react/img/favicon32x32.png" /><link rel="icon" type="image/png" sizes="48x48" href="/scalajs-react/img/favicon48x48.png" /><link rel="icon" type="image/png" sizes="57x57" href="/scalajs-react/img/favicon57x57.png" /><link rel="icon" type="image/png" sizes="60x60" href="/scalajs-react/img/favicon60x60.png" /><link rel="icon" type="image/png" sizes="64x64" href="/scalajs-react/img/favicon64x64.png" /><link rel="icon" type="image/png" sizes="70x70" href="/scalajs-react/img/favicon70x70.png" /><link rel="icon" type="image/png" sizes="72x72" href="/scalajs-react/img/favicon72x72.png" /><link rel="icon" type="image/png" sizes="76x76" href="/scalajs-react/img/favicon76x76.png" /><link rel="icon" type="image/png" sizes="96x96" href="/scalajs-react/img/favicon96x96.png" /><link rel="icon" type="image/png" sizes="114x114" href="/scalajs-react/img/favicon114x114.png" /><link rel="icon" type="image/png" sizes="120x120" href="/scalajs-react/img/favicon120x120.png" /><link rel="icon" type="image/png" sizes="128x128" href="/scalajs-react/img/favicon128x128.png" /><link rel="icon" type="image/png" sizes="144x144" href="/scalajs-react/img/favicon144x144.png" /><link rel="icon" type="image/png" sizes="150x150" href="/scalajs-react/img/favicon150x150.png" /><link rel="icon" type="image/png" sizes="152x152" href="/scalajs-react/img/favicon152x152.png" /><link rel="icon" type="image/png" sizes="196x196" href="/scalajs-react/img/favicon196x196.png" /><link rel="icon" type="image/png" sizes="310x310" href="/scalajs-react/img/favicon310x310.png" /><link rel="icon" type="image/png" sizes="310x150" href="/scalajs-react/img/favicon310x150.png" /><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" /><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" /><link rel="stylesheet" href="/scalajs-react/highlight/styles/default.css" /><link rel="stylesheet" href="/scalajs-react/css/style.css" /><link rel="stylesheet" href="/scalajs-react/css/palette.css" /><link rel="stylesheet" href="/scalajs-react/css/codemirror.css" /></head><body class="docs"><div id="wrapper"><div id="sidebar-wrapper"><ul id="sidebar" class="sidebar-nav"><li class="sidebar-brand"><a href="/scalajs-react/" class="brand"><div class="brand-wrapper"><span>scalajs-react</span></div></a></li> <li><a href="/scalajs-react/docs/index.html" class="">Getting Started</a></li> <li><a href="/scalajs-react/docs/creating.html" class="">Creating scala.js Components</a></li> <li><a href="/scalajs-react/docs/importing.html" class="">Importing from JS</a></li> <li><a href="/scalajs-react/docs/exporting.html" class="">Exporting to JS</a></li> <li><a href="/scalajs-react/docs/styling.html" class="">Styling Suggestions</a></li> <li><a href="/scalajs-react/docs/vdom.html" class="">Virtual DOM</a></li> <li><a href="/scalajs-react/docs/redux.html" class="">Redux</a></li> <li><a href="/scalajs-react/docs/datainterop.html" class="">Data interop</a></li> <li><a href="/scalajs-react/docs/fabric.html" class="">office-fabric-ui-react</a></li> <li><a href="/scalajs-react/docs/mixedproject.html" class="">Mixed Projects</a></li></ul></div><div id="page-content-wrapper"><div class="nav"><div class="container-fluid"><div class="row"><div class="col-lg-12"><div class="action-menu pull-left clearfix"><a href="#menu-toggle" id="menu-toggle"><i class="fa fa-bars" aria-hidden="true"></i></a></div><ul class="pull-right"><li id="gh-eyes-item" class="hidden-xs"><a href="https://github.com/aappddeevv/scalajs-react"><i class="fa fa-eye"></i><span>WATCH<span id="eyes" class="label label-default">--</span></span></a></li><li id="gh-stars-item" class="hidden-xs"><a href="https://github.com/aappddeevv/scalajs-react"><i class="fa fa-star-o"></i><span>STARS<span id="stars" class="label label-default">--</span></span></a></li><li><a href="#" onclick="shareSiteTwitter('scalajs-react A react integration library for scala.js in the spirit of ReasonReact');"><i class="fa fa-twitter"></i></a></li><li><a href="#" onclick="shareSiteFacebook('scalajs-react A react integration library for scala.js in the spirit of ReasonReact');"><i class="fa fa-facebook"></i></a></li><li><a href="#" onclick="shareSiteGoogle();"><i class="fa fa-google-plus"></i></a></li></ul></div></div></div></div><div id="content" data-github-owner="aappddeevv" data-github-repo="scalajs-react"><div class="content-wrapper"><section><p>Since there is an emphasis on interop with javascript reactjs components, you need to also interop with javascript data. Scala.js offers <code class="highlighter-rouge">js.UndefOr</code> to interop with fields in data structures that do not exist. Of course, in javascript a value can be undefined or null and sometimes they mean the same thing and sometimes not. Also, scala itself offers the ability to assign <code class="highlighter-rouge">null</code> (subclass of <code class="highlighter-rouge">Null</code>) to most values e.g. a String can be a value (“george”), empty (“”) or null.</p>

<p>Given that we also use native and non-native JS traits to describe the shape of data, we may wonder how to handle data from web apis, for example in the structure:</p>
<div class="language-typescript highlighter-rouge"><pre class="highlight"><code><span class="p">{</span> 
    <span class="nx">field1</span><span class="p">?:</span> <span class="kr">string</span>
    <span class="nx">field2</span><span class="p">?:</span> <span class="kr">string</span><span class="o">|</span><span class="kc">null</span>
<span class="p">}</span>
</code></pre>
</div>
<p>field1 can be undefined or a string and field2 can be a string value, undefined or null. Depending on the nature of the data source, you may encounter alot of field1 or field2 on some combination of that. For example, field1 could represent a value that is non-nullable in the source database but may not have been requested in a fetch and may not be present. field2 could represent a nullable field in the source database that was not requested or was requested and was null.</p>

<p>The question is how to best model these in scala so that we do not have to write an object conversion for each data structure. There was talk at one time to create a structure like UndefOr for nulls, <code class="highlighter-rouge">NullOr</code> however when you use a union type with null (whose type is Null), strange things can happen in scala’s type system, such as collapsing a <code class="highlighter-rouge">T|Null</code> to just T since a T can be null to begin with.</p>

<p>If you know the data is either there or not there, then UndefOr is fine:</p>
<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="k">trait</span> <span class="nc">Foo</span> <span class="k">extends</span> <span class="n">js</span><span class="o">.</span><span class="nc">Object</span> <span class="o">{</span>
  <span class="k">var</span> <span class="n">field</span><span class="k">:</span> <span class="kt">js.UndefOr</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span> <span class="c1">// var so mutable, use val for immutable
</span><span class="o">}</span>
</code></pre>
</div>
<p>However, if field can be null, undefined or a value what should we use? Consider:</p>
<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="k">trait</span> <span class="nc">Foo</span> <span class="k">extends</span> <span class="n">js</span><span class="o">.</span><span class="nc">Object</span> <span class="o">{</span>
  <span class="k">var</span> <span class="n">field1</span><span class="k">:</span> <span class="kt">js.UndefOr</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span>
<span class="o">}</span>
</code></pre>
</div>
<p>Here, the value may not be present but it could be null, which is <em>different</em> then not being present. In fact, we could test:</p>
<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="n">aFoo</span><span class="o">.</span><span class="n">field</span> <span class="o">==</span> <span class="kc">null</span>
</code></pre>
</div>
<p>Could return true or false depending on whether the value is null. In fact, scalajs-react provides a pimp:</p>
<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="k">final</span> <span class="k">case</span> <span class="k">class</span> <span class="nc">JsUndefOrOps</span><span class="o">[</span><span class="kt">A</span><span class="o">](</span><span class="n">a</span><span class="k">:</span> <span class="kt">UndefOr</span><span class="o">[</span><span class="kt">A</span><span class="o">])</span> <span class="o">{</span>
  <span class="k">def</span> <span class="n">isNull</span>  <span class="k">=</span> <span class="n">a</span> <span class="o">==</span> <span class="kc">null</span>
  <span class="k">def</span> <span class="n">isEmpty</span> <span class="k">=</span> <span class="n">isNull</span> <span class="o">||</span> <span class="o">!</span><span class="n">a</span><span class="o">.</span><span class="n">isDefined</span>
<span class="o">}</span>
</code></pre>
</div>
<p>which can be implicitly used by importing the syntax so you can test:</p>
<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="k">val</span> <span class="n">aBoolean</span> <span class="k">=</span> <span class="n">aFoo</span><span class="o">.</span><span class="n">field1</span><span class="o">.</span><span class="n">isNull</span> <span class="c1">// is it just null?
</span><span class="k">val</span> <span class="n">aBoolean2</span> <span class="k">=</span> <span class="n">afoo</span><span class="o">.</span><span class="n">field1</span><span class="o">.</span><span class="n">isEmpty</span> <span class="c1">// is it null or undefined
</span></code></pre>
</div>
<p>So we can test for null fairly easily given the <code class="highlighter-rouge">UndefOr</code> type definition. But we want to manipulate these things with some more functional syntax. For example, we would like an Option-based variant that is None if <code class="highlighter-rouge">isEmpty==true</code> and the value otherwise. Using <code class="highlighter-rouge">UndefOr.toOption</code> actually may wrap a “null” value and produce a <code class="highlighter-rouge">Some(null)</code> instead of None. So clearly, just using <code class="highlighter-rouge">.toOption</code> is not a good answer. So at the expense of a little boolean check, perhaps we could do something more convenient. Let’s state what we want, an Option that reflects both UndefOr and possible underlying null value:</p>
<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="k">final</span> <span class="k">case</span> <span class="k">class</span> <span class="nc">JsUndefOrOps</span><span class="o">[</span><span class="kt">A</span><span class="o">](</span><span class="n">a</span><span class="k">:</span> <span class="kt">UndefOr</span><span class="o">[</span><span class="kt">A</span><span class="o">])</span> <span class="o">{</span>
  <span class="nd">@inline</span> <span class="k">def</span> <span class="n">toNonNullOption</span> <span class="k">=</span> <span class="k">if</span><span class="o">(</span><span class="n">a</span><span class="o">.</span><span class="n">isEmpty</span><span class="o">)</span> <span class="nc">None</span> <span class="k">else</span> <span class="n">a</span><span class="o">.</span><span class="n">toOption</span>
<span class="o">}</span>
</code></pre>
</div>
<p>So now we can safely convert a UndefOr to an Option and have it be “null” if it is null or undefined and a Some with a non-null value otherwise. The cost you pay is a small conversion charge. So in general, it’s ok to model your data us UndefOr:</p>
<div class="language-scala highlighter-rouge"><pre class="highlight"><code> <span class="k">val</span> <span class="n">x</span><span class="k">:</span> <span class="kt">Option</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span> <span class="k">=</span> <span class="n">aFoo</span><span class="o">.</span><span class="n">field1</span><span class="o">.</span><span class="n">toNonNullOption</span>
</code></pre>
</div>
<p>Also, if you need to set data to null and the trait defines it as an UndefOr, just set it directly to null, just before you dispatch it javascript code:</p>
<div class="language-scala highlighter-rouge"><pre class="highlight"><code>  <span class="n">aFoo</span><span class="o">.</span><span class="n">field1</span> <span class="k">=</span> <span class="kc">null</span>
</code></pre>
</div>
<p>You should note that just declaring the attribute as a type:</p>
<div class="highlighter-rouge"><pre class="highlight"><code>trait Foo extends js.Object {
  var field1: String
}
</code></pre>
</div>
<p>does not communicate that it can be null explicitly as in typescript. Perhaps, a <code class="highlighter-rouge">var field1: String|Null</code>. There’s nothing wrong with that except scala already defines that String to be potentially null so why go through the hassle!</p>

<p>Also, if you see a trait with just a plain String and you want an Option just wrap it as in scala, <code class="highlighter-rouge">Option(field1)</code> since Option translates null to None in plain scala to begin with.</p>

<p>Check out <code class="highlighter-rouge">syntax.scala</code> for many pimps that you can apply to UndefOr values to help with data manipulation on the scala side. There’s alot there and its easy to forget them unless they are in a cheatsheet.</p>

<h2 id="tldr">TL;DR</h2>
<p>If your typescript says:</p>
<div class="language-typescript highlighter-rouge"><pre class="highlight"><code><span class="nx">field1</span><span class="p">?:</span> <span class="kr">string</span>
</code></pre>
</div>
<p>use:</p>
<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="k">var</span><span class="o">/</span><span class="k">val</span> <span class="n">field1</span><span class="k">:</span> <span class="kt">js.UndefOr</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span> <span class="k">=</span> <span class="n">js</span><span class="o">.</span><span class="n">undefined</span>
</code></pre>
</div>
<p>and set it to null <code class="highlighter-rouge">field1 = null</code> or use <code class="highlighter-rouge">field1.toNonNullOption</code> to extract more safely than just <code class="highlighter-rouge">toOption</code>.</p>

<p>If typescript says:</p>
<div class="language-typescript highlighter-rouge"><pre class="highlight"><code><span class="nx">field1</span><span class="p">?:</span> <span class="kr">string</span><span class="o">|</span><span class="kc">null</span>
</code></pre>
</div>
<p>Do the same thing as above because the first example was already doubly safe.</p>

<p>If typescript says:</p>
<div class="language-typescript highlighter-rouge"><pre class="highlight"><code><span class="nx">field1</span><span class="err">:</span> <span class="kr">string</span><span class="o">|</span><span class="kc">null</span>
</code></pre>
</div>
<p>use</p>
<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="k">var</span><span class="o">/</span><span class="k">val</span> <span class="n">field1</span><span class="k">:</span> <span class="kt">String</span>
</code></pre>
</div>
<p>and set it to null if you need to explicitly do that: <code class="highlighter-rouge">field1 = null</code>. And if you want to have an option, use <code class="highlighter-rouge">Option(field1)</code>. You must <code class="highlighter-rouge">Option</code> and not <code class="highlighter-rouge">Some</code> which would wrap a null value to <code class="highlighter-rouge">Some(null)</code>.</p>

<p>Let’s hope the typescript interface descriptions are correct!</p>
</section></div></div></div></div><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script><script src="/scalajs-react/highlight/highlight.pack.js"></script><script>hljs.configure({
languages:['scala','java','bash']
});
hljs.initHighlighting();
             </script><script src="/scalajs-react/js/main.js"></script></body></html>